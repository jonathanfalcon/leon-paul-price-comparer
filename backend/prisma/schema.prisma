generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Start `enum`

// Defines all valid product types. See `types/Common/ProductType.ts`.
enum ProductType {
  simple
  configurable
  bundle
}

// Defines all country codes. See `types/Common/RegionCodes.ts`.
enum CountryCode {
  AUS
  CAN
  DEU
  FRA
  ITA
  GBR
  UKR
  USA
}
// Start `model`

// This is where common product data is stored. The Product table closely resembles type LeonPaulCartItemBase in `types/AppData/LeonPaulCart/LeonPaulCart.ts`
model Product {
  sku         String      @id @unique
  imageUrl    String
  lastFetch   Int
  productType ProductType

  // Define one-to-many relationship with RegionalProductData table
  RegionalProductData RegionalProductData[]
}

// This is where regional product data is stored. The RegionalProductData table closely resembles types in union type LeonPaulProduct in `types/AppData/LeonPaulProduct/LeonPaulProduct.ts`
model RegionalProductData {
  sku                                        String
  country                                    CountryCode
  itemName                                   String
  url                                        String
  price_beforeTax                            Float
  price_afterTax                             Float
  // Define foreign key relationship to Product table
  Product                                    Product                                      @relation(fields: [sku], references: [sku])
  // Define one-to-many relationship with RegionalProductData_Configurable_Product table
  RegionalProductData_Configurable_Product   RegionalProductData_Configurable_Product[]
  // Define one-to-many relationship with RegionalProductData_Configurable_Attribute table
  RegionalProductData_Configurable_Attribute RegionalProductData_Configurable_Attribute[]
  // Define one-to-many relationship with RegionalProductData_Bundle_Option table
  RegionalProductData_Bundle_Option          RegionalProductData_Bundle_Option[]

  // Define composite primary key
  @@id([sku, country])
  @@unique([sku, country])
}

// This is where regional product configuration data when `productType: 'configurable'` is stored. This table closely resembles type CartItemProduct in `types/AppData/LeonPaulProduct/LeonPaulProduct.ts`
model RegionalProductData_Configurable_Product {
  sku                                                       String
  country                                                   CountryCode
  productId                                                 String
  price_beforeTax                                           Float
  price_afterTax                                            Float
  // Define foreign key relationship to RegionalProductData table
  RegionalProductData                                       RegionalProductData                                         @relation(fields: [sku, country], references: [sku, country])
  // Define one-to-many relationship with RegionalProductData_Configurable_Products_OptionSelection table
  RegionalProductData_Configurable_Product_OptionSelection RegionalProductData_Configurable_Product_OptionSelection[]

  // Define composite primary key
  @@id([sku, country, productId])
  @@unique([sku, country, productId])
}
